# candle_batch_aggregator: задачи и reasoning

## Цель
Реализовать CLI-инструмент для пакетной агрегации свечей из трейдов с поддержкой CSV, Parquet, DuckDB, QuestDB, ClickHouse и других форматов. Гибкая архитектура, расширяемость через адаптеры, интеграция с ядром candle_generator.

---

## Прогресс
- [x] CSV: чтение трейдов, агрегация, экспорт свечей, поддержка кастомных метрик через ядро candle_generator
- [ ] Parquet: чтение трейдов через polars, запись свечей через polars DataFrame
- [ ] DuckDB: заготовка модуля
- [ ] QuestDB: заготовка модуля
- [ ] ClickHouse: заготовка модуля
- [ ] Подключить новые форматы в main.rs
- [ ] Покрыть happy-path тестами и примерами

---

## Reasoning
- Каждый формат реализуется как отдельный модуль-адаптер, который конвертирует трейды в универсальную структуру Trade из candle_generator.
- После чтения трейдов из любого формата, агрегация и экспорт свечей происходят через уже реализованный пайплайн (aggregation.rs).
- Сначала реализуем Parquet (как наиболее востребованный формат для хранения исторических данных), затем аналогично — DuckDB, QuestDB, ClickHouse.
- Примеры для чтения Parquet уже есть в examples/from_parquet.rs (можно использовать как шаблон).

---

## Следующие шаги
1. Реализовать чтение трейдов из Parquet в модуле src/formats/parquet.rs (используем polars).
2. Реализовать запись свечей в Parquet (через polars DataFrame).
3. Добавить обработку формата Parquet в main.rs (аналогично CSV).
4. Обновить README и tasks/candle_batch_aggregator.md — зафиксировать прогресс, добавить примеры запуска.
5. Покрыть happy-path тестами и примером.

---

## Пути, которые уже проверены и не требуют повторной проверки
- Механика агрегации и экспорта для CSV полностью рабочая.
- candle_generator::Trade и Candle универсальны для всех форматов.
- Примеры для чтения Parquet уже есть в examples/from_parquet.rs (можно использовать как шаблон). 